language: node_js

node_js:
  - 4.2.3

services:
  - postgres

env:
  PORT=10010
  POSTGRES_HOST=127.0.0.1
  POSTGRES_DB=ci
  POSTGRES_USER=ci
  POSTGRES_PWD=ci

build:
  ci:
    - shippable_retry npm install -q && npm cache clean
    - gulp lint
    - psql -c 'create role ci with superuser PASSWORD ci;' -U postgres
    - psql -c 'create database ci;' -U postgres
    - gulp test:setup
    - nyc ava --tap | tap-xunit > shippable/testresults/results.xml",
    - nyc report --reporter=cobertura --report-dir ./shippable/codecoverage