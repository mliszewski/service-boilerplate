language: node_js

node_js:
  - 4.2.3

services:
  - postgres

env:
  PORT=10010
  POSTGRES_HOST=127.0.0.1
  POSTGRES_DB=ci
  POSTGRES_USER=ci
  POSTGRES_PWD=''

build:
  ci:
    - shippable_retry npm install -q && npm cache clean
    - ./node_modules/.bin/gulp lint
    - psql -c 'create user ci with superuser;' -U postgres
    - psql -c 'create database ci;' -U postgres
    - ./node_modules/.bin/gulp test:setup
    - nyc ava --tap | tap-xunit > shippable/testresults/results.xml
    - nyc report --reporter=cobertura --report-dir ./shippable/codecoverage